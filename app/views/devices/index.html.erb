
<% content_for :title, "Devices" %>

<!-- Add a single map container at the top -->
<div id="all_devices_map" style="height: 400px; width: 100%; margin-bottom: 30px;"></div>


<div id="devices" class="container" data-devices='<%= 
  @devices.map do |device|
    if device.state != nil && device.state.latitude1.present? && device.state.longitude1.present?
      {
        id: device.id,
        name: device.name,
        lat: device.state.latitude1,
        lng: device.state.longitude1,
        battery1_percent: device.state.battery1_percent,
        battery2_percent: device.state.battery2_percent
      }
    end
  end.compact.to_json.html_safe
%>'>
  <% @devices.each do |device| %>
    <div id="<%= dom_id device %>" class="device">
      <p>
      <%= render "summaryline", device: device %> 
      </p>

      <% if device.latest_photograph != nil %>
      <%= render device.latest_photograph %>
      <% else %>
      <p class="placeholder">Image unavailable.</p>
      <% end %>

      <% if device.state != nil %>
        <%= render device.state %>
      <% else %>
        <p class="placeholder">Device state available.</p>
      <% end %>


    </div>
  <% end %>
</div>

<!-- Game Controller Input Display -->
<div class="container mb-4">
  <div class="card">
    <details>
      <summary>Controller</summary>
    <div class="card-body">
      <p>Connect a game controller and press any button or move any stick to see the input.</p>
      <div class="form-group">
        <label for="lastGameInput">Last Input Received:</label>
        <input type="text" id="lastGameInput" class="form-control" readonly value="No input detected yet">
      </div>
      <div id="controllerStatus" class="mt-2 text-muted">No controller detected</div>
    </div>
    </details>
  </div>
</div>

